<html><head><meta content="text/html; charset=UTF-8" http-equiv="content-type">
</head><body class="c26"><h1 class="c30" id="h.p1oh57ghykfu"><span class="c31">Jerk Minimizing Algorithm for Trajectories Generation</span></h1><p class="c6 c13"><span class="c1"></span></p><h2 class="c27" id="h.ea1qusovzbl1"><span class="c10">Overview:</span></h2><ul class="c33 lst-kix_vocg9dsh5o45-0 start"><li class="c6 c22"><span>Apply a </span><span class="c3">quintic polynomial solver in C++ to</span><span class="c2">&nbsp;minimize Jerk motion in a self-driving car</span></li></ul><h2 class="c27" id="h.ur29a8y3rbxd"><span>Intro:</span></h2><p class="c6"><span class="c1">I order to have continuous trajectories we need to minimize Jerk movement. </span></p><p class="c6"><span class="c1">Jerk is the 3rd derivative of position.</span></p><p class="c6"><span class="c1">Because we would like to penalize negative and positive jerk we are using total square jerk. </span></p><p class="c6"><span style="overflow: hidden; display: inline-block; margin: 0.00px 0.00px; border: 0.00px solid #000000; transform: rotate(0.00rad) translateZ(0px); -webkit-transform: rotate(0.00rad) translateZ(0px); width: 424.00px; height: 185.00px;"><img alt="" src="images/image3.png" style="width: 424.00px; height: 185.00px; margin-left: 0.00px; margin-top: 0.00px; transform: rotate(0.00rad) translateZ(0px); -webkit-transform: rotate(0.00rad) translateZ(0px);" title=""></span></p><p class="c6 c13"><span class="c1"></span></p><p class="c6"><span>To obtain minimum the minimum jerk all coefficients greater than 6 &nbsp;should be zero. Which means all order of transitions can be represented by a </span><span class="c3">quintic function. </span></p><p class="c11"><span class="c3">A quintic function is defined by a </span><span class="c24"><a class="c12" href="https://www.google.com/url?q=https://en.wikipedia.org/wiki/Polynomial&amp;sa=D&amp;ust=1518332645299000&amp;usg=AFQjCNEtcVKa6uz7mtLG3TuBY3S0-uLlXw">polynomial</a></span><span class="c3">&nbsp;of </span><span class="c24"><a class="c12" href="https://www.google.com/url?q=https://en.wikipedia.org/wiki/Degree_of_a_polynomial&amp;sa=D&amp;ust=1518332645299000&amp;usg=AFQjCNGkvSU7lUTL7Hd1PzceYkmZ9Jdb0w">degree</a></span><span class="c3">&nbsp;five. Where </span><span class="c16">a</span><span class="c3">, </span><span class="c16">b</span><span class="c3">, </span><span class="c16">c</span><span class="c3">, </span><span class="c16">d</span><span class="c3">, </span><span class="c16">e,</span><span class="c3">&nbsp;and </span><span class="c16">f</span><span class="c3">&nbsp;are coefficients that we can choose to define the motion of our vehicle.</span></p><p class="c18"><span style="overflow: hidden; display: inline-block; margin: 0.00px 0.00px; border: 0.00px solid #000000; transform: rotate(0.00rad) translateZ(0px); -webkit-transform: rotate(0.00rad) translateZ(0px); width: 357.00px; height: 31.00px;"><img alt="" src="images/image1.png" style="width: 357.00px; height: 31.00px; margin-left: 0.00px; margin-top: 0.00px; transform: rotate(0.00rad) translateZ(0px); -webkit-transform: rotate(0.00rad) translateZ(0px);" title=""></span></p><p class="c11"><span class="c2">In this case we would be using:</span></p><p class="c11"><span class="c2">[Si, Si&rsquo;, Si&rsquo;&rsquo;, Sf, Sf&rsquo;, Sf&rsquo;&rsquo;]</span></p><a id="t.3c3d0b0f2f354ae9f90702fe670fb83ff92c02e2"></a><a id="t.0"></a><table class="c9"><tbody><tr class="c29"><td class="c7" colspan="1" rowspan="1"><p class="c5"><span class="c2">S &nbsp;= POSITION</span></p><p class="c5"><span class="c2">S&rsquo; = SPEED</span></p><p class="c5"><span class="c2">S&rsquo;&rsquo; = ACCELERATION</span></p><p class="c5 c13"><span class="c2"></span></p><p class="c5"><span class="c2">i = INITIAL</span></p><p class="c5"><span class="c2">f = FINAL</span></p></td><td class="c21" colspan="1" rowspan="1"><p class="c5"><span style="overflow: hidden; display: inline-block; margin: 0.00px 0.00px; border: 0.00px solid #000000; transform: rotate(0.00rad) translateZ(0px); -webkit-transform: rotate(0.00rad) translateZ(0px); width: 349.00px; height: 116.00px;"><img alt="" src="images/image6.png" style="width: 349.00px; height: 116.00px; margin-left: 0.00px; margin-top: 0.00px; transform: rotate(0.00rad) translateZ(0px); -webkit-transform: rotate(0.00rad) translateZ(0px);" title=""></span></p></td></tr><tr class="c14"><td class="c7" colspan="1" rowspan="2"><p class="c32 c20"><span class="c28">Because we now our parameters </span><span class="c3">[Si, Si&rsquo;, Si&rsquo;&rsquo;, Sf, Sf&rsquo;, Sf&rsquo;&rsquo;] at time zero and at final time</span><span class="c28">, We can simplify this system of equations know and unowns. And then, to a matrix that looks like this.</span></p></td><td class="c21" colspan="1" rowspan="1"><p class="c6"><span style="overflow: hidden; display: inline-block; margin: 0.00px 0.00px; border: 0.00px solid #000000; transform: rotate(0.00rad) translateZ(0px); -webkit-transform: rotate(0.00rad) translateZ(0px); width: 353.00px; height: 88.00px;"><img alt="" src="images/image2.png" style="width: 353.00px; height: 88.00px; margin-left: 0.00px; margin-top: 0.00px; transform: rotate(0.00rad) translateZ(0px); -webkit-transform: rotate(0.00rad) translateZ(0px);" title=""></span></p></td></tr><tr class="c14"><td class="c21" colspan="1" rowspan="1"><p class="c5"><span style="overflow: hidden; display: inline-block; margin: 0.00px 0.00px; border: 0.00px solid #000000; transform: rotate(0.00rad) translateZ(0px); -webkit-transform: rotate(0.00rad) translateZ(0px); width: 353.00px; height: 106.67px;"><img alt="" src="images/image5.png" style="width: 353.00px; height: 106.67px; margin-left: 0.00px; margin-top: 0.00px; transform: rotate(0.00rad) translateZ(0px); -webkit-transform: rotate(0.00rad) translateZ(0px);" title=""></span></p></td></tr><tr class="c14"><td class="c34" colspan="2" rowspan="1"><p class="c20 c32"><span style="overflow: hidden; display: inline-block; margin: 0.00px 0.00px; border: 0.00px solid #000000; transform: rotate(0.00rad) translateZ(0px); -webkit-transform: rotate(0.00rad) translateZ(0px); width: 517.00px; height: 97.33px;"><img alt="" src="images/image4.png" style="width: 517.00px; height: 97.33px; margin-left: 0.00px; margin-top: 0.00px; transform: rotate(0.00rad) translateZ(0px); -webkit-transform: rotate(0.00rad) translateZ(0px);" title=""></span></p></td></tr></tbody></table><p class="c6 c13"><span class="c1"></span></p><p class="c6"><span class="c1">Using Eiger this is the implementation in C++ (main.cpp ln37-59):</span></p><p class="c6 c13"><span class="c1"></span></p><a id="t.dca436d6a4caf58ccd130952d4567f30fb76f5a9"></a><a id="t.1"></a><table class="c9"><tbody><tr class="c29"><td class="c8" colspan="1" rowspan="1"><p class="c25"><span class="c0">vector&lt;double&gt; JMT(vector&lt; double&gt; start, vector &lt;double&gt; end, double T)<br>{<br> &nbsp; MatrixXd A = MatrixXd(</span><span class="c4">3</span><span class="c0">, </span><span class="c4">3</span><span class="c0">);<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;A &lt;&lt; T*T*T, T*T*T*T, T*T*T*T*T,<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; &nbsp; &nbsp;</span><span class="c4">3</span><span class="c0">*T*T, </span><span class="c4">4</span><span class="c0">*T*T*T,</span><span class="c4">5</span><span class="c0">*T*T*T*T,<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; &nbsp; &nbsp;</span><span class="c4">6</span><span class="c0">*T, </span><span class="c4">12</span><span class="c0">*T*T, </span><span class="c4">20</span><span class="c0">*T*T*T;<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;MatrixXd B = MatrixXd(</span><span class="c4">3</span><span class="c0">,</span><span class="c4">1</span><span class="c0">);&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; &nbsp; &nbsp;<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;B &lt;&lt; end[</span><span class="c4">0</span><span class="c0">]-(start[</span><span class="c4">0</span><span class="c0">]+start[</span><span class="c4">1</span><span class="c0">]*T+</span><span class="c4">.5</span><span class="c0">*start[</span><span class="c4">2</span><span class="c0">]*T*T),<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; &nbsp; &nbsp;end[</span><span class="c4">1</span><span class="c0">]-(start[</span><span class="c4">1</span><span class="c0">]+start[</span><span class="c4">2</span><span class="c0">]*T),<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; &nbsp; &nbsp;end[</span><span class="c4">2</span><span class="c0">]-start[</span><span class="c4">2</span><span class="c0">];<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; &nbsp; &nbsp;<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;MatrixXd Ai = A.inverse();<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;MatrixXd C = Ai*B;<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;vector &lt;double&gt; result = {start[</span><span class="c4">0</span><span class="c0">], start[</span><span class="c4">1</span><span class="c0">], </span><span class="c4">.5</span><span class="c0">*start[</span><span class="c4">2</span><span class="c0">]};<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="c15">for</span><span class="c0">(int i = </span><span class="c4">0</span><span class="c0">; i &lt; C.size(); i++)<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;{<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; &nbsp; &nbsp;result.push_back(C.data()[i]);<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}<br> &nbsp; &nbsp;</span><span class="c15">return</span><span class="c0">&nbsp;result;<br>}</span></p></td></tr></tbody></table><p class="c6 c13"><span class="c1"></span></p><p class="c6 c13"><span class="c1"></span></p><p class="c6"><span class="c1">Udacity Self-Driving Car </span></p><p class="c6"><span class="c23"><a class="c12" href="https://www.google.com/url?q=https://d17h27t6h515a5.cloudfront.net/topher/2017/July/595fe838_junior-the-stanford-entry-in-the-urban-challenge/junior-the-stanford-entry-in-the-urban-challenge.pdf&amp;sa=D&amp;ust=1518332645312000&amp;usg=AFQjCNHO6u5JH_7cGiDGjn7-l_GsAc_bIw">Junior: The Stanford Entry in the Urban Challenge</a></span></p><p class="c6 c13"><span class="c1"></span></p></body></html>