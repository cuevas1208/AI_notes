<html><head><meta content="text/html; charset=UTF-8" http-equiv="content-type"></head><body class="c19"><h1 class="c33" id="h.p1oh57ghykfu"><span class="c32">Jerk Minimizing Algorithm for Trajectories Generation</span></h1><p class="c18 c24"><span class="c4"></span></p><h2 class="c2" id="h.ea1qusovzbl1"><span class="c7">Overview:</span></h2><ul class="c29 lst-kix_vocg9dsh5o45-0 start"><li class="c18 c30"><span>Apply a </span><span class="c6">quintic polynomial solver in C++ to</span><span class="c16 c6">&nbsp;minimize Jerk motion in a self-driving car</span></li></ul><h2 class="c2" id="h.ur29a8y3rbxd"><span>Intro:</span></h2><p class="c18"><span class="c4">In order to have continuous trajectories we need to minimize Jerk movement. </span></p><p class="c18"><span class="c4">Jerk is the 3rd derivative of position.</span></p><p class="c18"><span class="c4">Because we would like to penalize negative and positive jerk we are using total square jerk. </span></p><p class="c18"><span style="overflow: hidden; display: inline-block; margin: 0.00px 0.00px; border: 0.00px solid #000000; transform: rotate(0.00rad) translateZ(0px); -webkit-transform: rotate(0.00rad) translateZ(0px); width: 424.00px; height: 185.00px;"><img alt="" src="images/image3.png" style="width: 424.00px; height: 185.00px; margin-left: 0.00px; margin-top: 0.00px; transform: rotate(0.00rad) translateZ(0px); -webkit-transform: rotate(0.00rad) translateZ(0px);" title=""></span></p><p class="c18 c24"><span class="c4"></span></p><p class="c18"><span>To obtain the minimum jerk, all coefficients greater than 6 &nbsp;should be zero. Which means all order of transitions can be represented by a </span><span class="c6">quintic function. </span></p><p class="c26"><span class="c6">A quintic function is defined by a </span><span class="c22"><a class="c8" href="https://www.google.com/url?q=https://en.wikipedia.org/wiki/Polynomial&amp;sa=D&amp;ust=1518333050193000&amp;usg=AFQjCNFV9KTVVx6AZ6lsoohPp297gF8LLQ">polynomial</a></span><span class="c6">&nbsp;of </span><span class="c22"><a class="c8" href="https://www.google.com/url?q=https://en.wikipedia.org/wiki/Degree_of_a_polynomial&amp;sa=D&amp;ust=1518333050193000&amp;usg=AFQjCNHKwnpmwIOKbPPrWADdWj5osLWfhw">degree</a></span><span class="c6">&nbsp;five. Where </span><span class="c20">a</span><span class="c6">, </span><span class="c20">b</span><span class="c6">, </span><span class="c20">c</span><span class="c6">, </span><span class="c20">d</span><span class="c6">, </span><span class="c20">e,</span><span class="c6">&nbsp;and </span><span class="c20">f</span><span class="c6">&nbsp;are avalable coefficients that we can choose to define the motion of our vehicle.</span></p><p class="c21 c31"><span style="overflow: hidden; display: inline-block; margin: 0.00px 0.00px; border: 0.00px solid #000000; transform: rotate(0.00rad) translateZ(0px); -webkit-transform: rotate(0.00rad) translateZ(0px); width: 357.00px; height: 31.00px;"><img alt="" src="images/image1.png" style="width: 357.00px; height: 31.00px; margin-left: 0.00px; margin-top: 0.00px; transform: rotate(0.00rad) translateZ(0px); -webkit-transform: rotate(0.00rad) translateZ(0px);" title=""></span></p><p class="c26"><span class="c16 c6">The parameters that best fit to minimize Jerk are:</span></p><p class="c26"><span class="c16 c6">[Si, Si&rsquo;, Si&rsquo;&rsquo;, Sf, Sf&rsquo;, Sf&rsquo;&rsquo;]</span></p><a id="t.3c3d0b0f2f354ae9f90702fe670fb83ff92c02e2"></a><a id="t.0"></a><table class="c12"><tbody><tr class="c14"><td class="c13" colspan="1" rowspan="1"><p class="c1"><span class="c16 c6">S &nbsp;= POSITION</span></p><p class="c1"><span class="c16 c6">S&rsquo; = SPEED</span></p><p class="c1"><span class="c16 c6">S&rsquo;&rsquo; = ACCELERATION</span></p><p class="c1 c24"><span class="c16 c6"></span></p><p class="c1"><span class="c16 c6">i = INITIAL</span></p><p class="c1"><span class="c16 c6">f = FINAL</span></p></td><td class="c23" colspan="1" rowspan="1"><p class="c1"><span style="overflow: hidden; display: inline-block; margin: 0.00px 0.00px; border: 0.00px solid #000000; transform: rotate(0.00rad) translateZ(0px); -webkit-transform: rotate(0.00rad) translateZ(0px); width: 349.00px; height: 116.00px;"><img alt="" src="images/image6.png" style="width: 349.00px; height: 116.00px; margin-left: 0.00px; margin-top: 0.00px; transform: rotate(0.00rad) translateZ(0px); -webkit-transform: rotate(0.00rad) translateZ(0px);" title=""></span></p></td></tr><tr class="c17"><td class="c13" colspan="1" rowspan="2"><p class="c21"><span class="c5">Because we now our parameters </span><span class="c6">[Si, Si&rsquo;, Si&rsquo;&rsquo;, Sf, Sf&rsquo;, Sf&rsquo;&rsquo;] at time zero and at final time</span><span class="c5">, We can simplify this system of equations know and unowns. And then, to a matrix that looks like this.</span></p></td><td class="c23" colspan="1" rowspan="1"><p class="c18"><span style="overflow: hidden; display: inline-block; margin: 0.00px 0.00px; border: 0.00px solid #000000; transform: rotate(0.00rad) translateZ(0px); -webkit-transform: rotate(0.00rad) translateZ(0px); width: 353.00px; height: 88.00px;"><img alt="" src="images/image2.png" style="width: 353.00px; height: 88.00px; margin-left: 0.00px; margin-top: 0.00px; transform: rotate(0.00rad) translateZ(0px); -webkit-transform: rotate(0.00rad) translateZ(0px);" title=""></span></p></td></tr><tr class="c17"><td class="c23" colspan="1" rowspan="1"><p class="c1"><span style="overflow: hidden; display: inline-block; margin: 0.00px 0.00px; border: 0.00px solid #000000; transform: rotate(0.00rad) translateZ(0px); -webkit-transform: rotate(0.00rad) translateZ(0px); width: 353.00px; height: 106.67px;"><img alt="" src="images/image5.png" style="width: 353.00px; height: 106.67px; margin-left: 0.00px; margin-top: 0.00px; transform: rotate(0.00rad) translateZ(0px); -webkit-transform: rotate(0.00rad) translateZ(0px);" title=""></span></p></td></tr><tr class="c17"><td class="c15" colspan="2" rowspan="1"><p class="c21"><span style="overflow: hidden; display: inline-block; margin: 0.00px 0.00px; border: 0.00px solid #000000; transform: rotate(0.00rad) translateZ(0px); -webkit-transform: rotate(0.00rad) translateZ(0px); width: 517.00px; height: 97.33px;"><img alt="" src="images/image4.png" style="width: 517.00px; height: 97.33px; margin-left: 0.00px; margin-top: 0.00px; transform: rotate(0.00rad) translateZ(0px); -webkit-transform: rotate(0.00rad) translateZ(0px);" title=""></span></p></td></tr></tbody></table><p class="c18 c24"><span class="c4"></span></p><p class="c18"><span class="c4">Using Eiger this is the implementation in C++ (main.cpp ln37-59):</span></p><p class="c18 c24"><span class="c4"></span></p><a id="t.dca436d6a4caf58ccd130952d4567f30fb76f5a9"></a><a id="t.1"></a><table class="c12"><tbody><tr class="c14"><td class="c9" colspan="1" rowspan="1"><p class="c34"><span class="c0">vector&lt;double&gt; JMT(vector&lt; double&gt; start, vector &lt;double&gt; end, double T)<br>{<br> &nbsp; MatrixXd A = MatrixXd(</span><span class="c10">3</span><span class="c0">, </span><span class="c10">3</span><span class="c0">);<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;A &lt;&lt; T*T*T, T*T*T*T, T*T*T*T*T,<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; &nbsp; &nbsp;</span><span class="c10">3</span><span class="c0">*T*T, </span><span class="c10">4</span><span class="c0">*T*T*T,</span><span class="c10">5</span><span class="c0">*T*T*T*T,<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; &nbsp; &nbsp;</span><span class="c10">6</span><span class="c0">*T, </span><span class="c10">12</span><span class="c0">*T*T, </span><span class="c10">20</span><span class="c0">*T*T*T;<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;MatrixXd B = MatrixXd(</span><span class="c10">3</span><span class="c0">,</span><span class="c10">1</span><span class="c0">);&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; &nbsp; &nbsp;<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;B &lt;&lt; end[</span><span class="c10">0</span><span class="c0">]-(start[</span><span class="c10">0</span><span class="c0">]+start[</span><span class="c10">1</span><span class="c0">]*T+</span><span class="c10">.5</span><span class="c0">*start[</span><span class="c10">2</span><span class="c0">]*T*T),<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; &nbsp; &nbsp;end[</span><span class="c10">1</span><span class="c0">]-(start[</span><span class="c10">1</span><span class="c0">]+start[</span><span class="c10">2</span><span class="c0">]*T),<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; &nbsp; &nbsp;end[</span><span class="c10">2</span><span class="c0">]-start[</span><span class="c10">2</span><span class="c0">];<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; &nbsp; &nbsp;<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;MatrixXd Ai = A.inverse();<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;MatrixXd C = Ai*B;<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;vector &lt;double&gt; result = {start[</span><span class="c10">0</span><span class="c0">], start[</span><span class="c10">1</span><span class="c0">], </span><span class="c10">.5</span><span class="c0">*start[</span><span class="c10">2</span><span class="c0">]};<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="c11">for</span><span class="c0">(int i = </span><span class="c10">0</span><span class="c0">; i &lt; C.size(); i++)<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;{<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; &nbsp; &nbsp;result.push_back(C.data()[i]);<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}<br> &nbsp; &nbsp;</span><span class="c11">return</span><span class="c0">&nbsp;result;<br>}</span></p></td></tr></tbody></table><p class="c18 c24"><span class="c4"></span></p><h2 class="c2" id="h.kpumfxhu7sl8"><span class="c7">References:</span></h2><p class="c18"><span class="c4">Udacity Self-Driving Car </span></p><p class="c18"><span class="c28"><a class="c8" href="https://www.google.com/url?q=https://d17h27t6h515a5.cloudfront.net/topher/2017/July/595fe838_junior-the-stanford-entry-in-the-urban-challenge/junior-the-stanford-entry-in-the-urban-challenge.pdf&amp;sa=D&amp;ust=1518333050204000&amp;usg=AFQjCNEyjz_hNMm5ZW_4dQr1M9GVz7bgLQ">Junior: The Stanford Entry in the Urban Challenge</a></span></p><p class="c18 c24"><span class="c4"></span></p></body></html>